---
/**
 * Navbar — fixed top navigation for QuickSay marketing site.
 * Uses a hidden-checkbox pattern for mobile menu (no JS framework).
 * IntersectionObserver toggles the nav CTA after hero scroll.
 */
import BetaCTA from './BetaCTA.astro';
---

<header
  class="fixed top-0 left-0 w-full z-50 border-b border-border"
  id="site-nav"
>
  <div class="nav-bg absolute inset-0"></div>

  <nav class="relative max-w-6xl mx-auto flex items-center justify-between h-16 px-6" aria-label="Main navigation">
    <!-- Logo / Wordmark -->
    <a href="/" class="flex items-center gap-3 shrink-0" aria-label="QuickSay home">
      <img src="/logo.svg" alt="QuickSay voice-to-text app icon featuring minimalist microphone on teal gradient" width="40" height="40" class="w-10 h-10" />
      <span class="font-headline font-bold text-xl">
        <span class="text-accent-teal">Q</span><span class="text-text-primary">uickSay</span>
      </span>
    </a>

    <!-- Desktop Nav Links (hidden below md) -->
    <ul class="hidden md:flex items-center gap-8" role="list">
      <li><a href="/#hero" class="nav-link">Home</a></li>
      <li><a href="/beta" class="nav-link">Open Beta</a></li>
      <li><a href="/docs" class="nav-link">Docs</a></li>
      <li><a href="/blog" class="nav-link">Blog</a></li>
      <li><a href="/download" class="nav-link">Download</a></li>
    </ul>

    <!-- Desktop CTA (hidden until scroll past hero) -->
    <div id="nav-cta" class="hidden md:block">
      <div class="relative inline-block">
        <span class="absolute -top-2 -right-2 bg-accent-orange text-background text-[10px] font-bold px-2 py-0.5 rounded-full uppercase tracking-wide">
          Free
        </span>
        <BetaCTA text="Join Beta" size="small" />
      </div>
    </div>

    <!-- Mobile: hamburger toggle -->
    <input type="checkbox" id="mobile-menu-toggle" class="peer sr-only" aria-hidden="true" />
    <label
      for="mobile-menu-toggle"
      class="md:hidden relative z-50 flex flex-col justify-center items-center w-10 h-10 cursor-pointer"
      aria-label="Toggle navigation menu"
    >
      <span class="hamburger-line hamburger-top"></span>
      <span class="hamburger-line hamburger-mid"></span>
      <span class="hamburger-line hamburger-bot"></span>
    </label>

    <!-- Mobile Menu Panel -->
    <div class="mobile-panel" id="mobile-panel">
      <ul class="flex flex-col items-center gap-8 pt-24" role="list">
        <li><a href="/#hero" class="mobile-link">Home</a></li>
        <li><a href="/beta" class="mobile-link">Open Beta</a></li>
        <li><a href="/docs" class="mobile-link">Docs</a></li>
        <li><a href="/blog" class="mobile-link">Blog</a></li>
        <li><a href="/download" class="mobile-link">Download</a></li>
        <li>
          <div class="relative inline-block">
            <span class="absolute -top-2 -right-2 bg-accent-orange text-background text-[10px] font-bold px-2 py-0.5 rounded-full uppercase tracking-wide">
              Free
            </span>
            <BetaCTA text="Join Beta" />
          </div>
        </li>
      </ul>
    </div>
  </nav>
</header>

<!-- Sentinel element at the bottom of the hero for IntersectionObserver -->
<div id="hero-sentinel" class="absolute top-[100vh] left-0 h-px w-px" aria-hidden="true"></div>

<style>
  /* Nav background: semi-transparent surface + blur */
  .nav-bg {
    background-color: rgba(28, 28, 32, 0.82);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
  }

  /* Desktop nav link with teal underline on hover */
  .nav-link {
    position: relative;
    color: var(--text-secondary);
    font-size: 0.875rem;
    font-weight: 500;
    transition: color 200ms ease;
    padding-bottom: 2px;
  }

  .nav-link::after {
    content: '';
    position: absolute;
    left: 0;
    bottom: -2px;
    width: 100%;
    height: 2px;
    background-color: var(--accent-teal);
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 200ms ease;
  }

  .nav-link:hover {
    color: var(--text-primary);
  }

  .nav-link:hover::after {
    transform: scaleX(1);
  }

  /* Nav CTA visibility */
  #nav-cta {
    opacity: 0;
    pointer-events: none;
    transition: opacity 200ms ease;
  }

  #nav-cta.is-shown {
    opacity: 1;
    pointer-events: auto;
  }


  /* Hamburger lines */
  .hamburger-line {
    display: block;
    width: 22px;
    height: 2px;
    background-color: var(--text-primary);
    border-radius: 1px;
    transition: transform 250ms ease, opacity 250ms ease;
  }

  .hamburger-top { margin-bottom: 5px; }
  .hamburger-mid { margin-bottom: 5px; }

  /* Hamburger → X when checked */
  #mobile-menu-toggle:checked ~ label .hamburger-top {
    transform: translateY(7px) rotate(45deg);
  }
  #mobile-menu-toggle:checked ~ label .hamburger-mid {
    opacity: 0;
  }
  #mobile-menu-toggle:checked ~ label .hamburger-bot {
    transform: translateY(-7px) rotate(-45deg);
  }

  /* Mobile panel: slides in from right */
  .mobile-panel {
    position: fixed;
    top: 0;
    right: 0;
    width: 100%;
    height: 100dvh;
    background-color: var(--surface);
    transform: translateX(100%);
    transition: transform 300ms ease;
    z-index: 40;
    overflow-y: auto;
  }

  #mobile-menu-toggle:checked ~ .mobile-panel {
    transform: translateX(0);
  }

  .mobile-link {
    color: var(--text-primary);
    font-family: 'Outfit', sans-serif;
    font-size: 1.25rem;
    font-weight: 600;
    transition: color 150ms ease;
    display: inline-flex;
    align-items: center;
    min-height: 44px;
  }

  .mobile-link:hover {
    color: var(--accent-teal);
  }
</style>

<script>
  // Nav CTA: show after scrolling past hero (~100vh)
  // Mobile menu: close on link click
  // Total: well under 500 bytes
  const s=document.getElementById('hero-sentinel'),c=document.getElementById('nav-cta'),t=document.getElementById('mobile-menu-toggle');
  if(s&&c){new IntersectionObserver(([e])=>{c.classList.toggle('is-shown',!e.isIntersecting)},{threshold:0}).observe(s)}
  document.getElementById('mobile-panel')?.querySelectorAll('a').forEach(a=>a.addEventListener('click',()=>{if(t)t.checked=false}));
</script>
