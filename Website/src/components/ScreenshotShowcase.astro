---
/**
 * ScreenshotShowcase Component
 *
 * 4-tab gallery showcasing real app screenshots with click-to-expand lightbox.
 * Tabs: Dashboard (Statistics), Smart Modes, Custom Dictionary, Easy Setup
 *
 * Performance:
 * - Lazy load inactive tabs
 * - CSS-only animations
 * - Click-to-expand lightbox using dialog element
 * - <200KB total, <500 bytes JS
 */
import OptimizedImage from './OptimizedImage.astro';
---

<section id="screenshots" class="py-24 md:py-32 bg-background">
  <div class="mx-auto max-w-6xl px-6">
    <!-- Headline -->
    <div class="text-center mb-12 fade-in-up">
      <h2 class="font-headline font-semibold text-3xl md:text-4xl text-text-primary text-balance mb-4">
        The real thing.
      </h2>
      <p class="font-body text-text-secondary text-lg max-w-2xl mx-auto">
        No mockups. No staged demos. This is QuickSay running on Windows, captured directly from the app.
      </p>
    </div>

    <!-- Tab bar — segmented control like Persona Tabs -->
    <div class="flex justify-start sm:justify-center gap-2 mb-10 fade-in-up overflow-x-auto pb-2 -mx-6 px-6 sm:mx-0 sm:px-0 sm:overflow-visible" role="tablist" aria-label="Screenshot tabs" id="screenshot-tablist">
      <button
        role="tab"
        aria-selected="true"
        aria-controls="panel-statistics"
        id="tab-statistics"
        class="screenshot-tab font-headline font-medium text-sm py-3 px-4 sm:px-6 cursor-pointer rounded-lg transition-all duration-150 text-accent-teal border-b-2 border-accent-teal whitespace-nowrap shrink-0"
      >Dashboard</button>
      <button
        role="tab"
        aria-selected="false"
        aria-controls="panel-modes"
        id="tab-modes"
        class="screenshot-tab font-headline font-medium text-sm py-3 px-4 sm:px-6 cursor-pointer rounded-lg transition-all duration-150 text-text-secondary border-b-2 border-transparent whitespace-nowrap shrink-0"
      >Smart Modes</button>
      <button
        role="tab"
        aria-selected="false"
        aria-controls="panel-dictionary"
        id="tab-dictionary"
        class="screenshot-tab font-headline font-medium text-sm py-3 px-4 sm:px-6 cursor-pointer rounded-lg transition-all duration-150 text-text-secondary border-b-2 border-transparent whitespace-nowrap shrink-0"
      >Custom Dictionary</button>
      <button
        role="tab"
        aria-selected="false"
        aria-controls="panel-onboarding"
        id="tab-onboarding"
        class="screenshot-tab font-headline font-medium text-sm py-3 px-4 sm:px-6 cursor-pointer rounded-lg transition-all duration-150 text-text-secondary border-b-2 border-transparent whitespace-nowrap shrink-0"
      >Easy Setup</button>
    </div>

    <!-- Tab Panels -->
    <div class="relative fade-in-up max-w-3xl mx-auto">
      <!-- Statistics Panel -->
      <div role="tabpanel" id="panel-statistics" aria-labelledby="tab-statistics" class="screenshot-panel transition-opacity duration-300 opacity-100">
        <button
          class="bg-surface border border-border rounded-xl overflow-hidden card-hover cursor-zoom-in w-full text-left"
          data-lightbox-trigger
          data-lightbox-src="/images/screenshots/statistics-full.png?v=4"
          data-lightbox-alt="Full-size view of QuickSay Dashboard showing usage statistics: total transcriptions, time saved, word count, and daily usage charts"
          aria-label="View full-size screenshot of QuickSay Dashboard"
        >
          <OptimizedImage
            src="statistics"
            type="screenshot"
            variant="full"
            alt="QuickSay Dashboard showing usage statistics: total transcriptions, time saved, word count, and daily usage charts"
            width={800}
            height={500}
            loading="eager"
            class="w-full h-auto"
          />
        </button>
        <p class="text-center font-body text-text-tertiary text-sm mt-4">
          Track your usage, monitor accuracy, and see how much time QuickSay saves you.
        </p>
      </div>

      <!-- Modes Panel -->
      <div role="tabpanel" id="panel-modes" aria-labelledby="tab-modes" class="screenshot-panel transition-opacity duration-300 opacity-0 hidden">
        <button
          class="bg-surface border border-border rounded-xl overflow-hidden card-hover cursor-zoom-in w-full text-left"
          data-lightbox-trigger
          data-lightbox-src="/images/screenshots/modes-full.png?v=4"
          data-lightbox-alt="Full-size view of QuickSay Custom Modes showing Standard, Email, Code, and Casual formatting presets with Add Custom Mode option"
          aria-label="View full-size screenshot of QuickSay Smart Modes"
        >
          <OptimizedImage
            src="modes"
            type="screenshot"
            variant="full"
            alt="QuickSay Custom Modes showing Standard, Email, Code, and Casual formatting presets with Add Custom Mode option"
            width={800}
            height={500}
            loading="lazy"
            class="w-full h-auto"
          />
        </button>
        <p class="text-center font-body text-text-tertiary text-sm mt-4">
          Switch between Smart Modes for different contexts: code comments, formal emails, casual notes.
        </p>
      </div>

      <!-- Dictionary Panel -->
      <div role="tabpanel" id="panel-dictionary" aria-labelledby="tab-dictionary" class="screenshot-panel transition-opacity duration-300 opacity-0 hidden">
        <button
          class="bg-surface border border-border rounded-xl overflow-hidden card-hover cursor-zoom-in w-full text-left"
          data-lightbox-trigger
          data-lightbox-src="/images/screenshots/dictionary-full.png?v=4"
          data-lightbox-alt="Full-size view of QuickSay Custom Dictionary showing user-defined terms, technical jargon, and pronunciation mappings"
          aria-label="View full-size screenshot of QuickSay Custom Dictionary"
        >
          <OptimizedImage
            src="dictionary"
            type="screenshot"
            variant="full"
            alt="QuickSay Custom Dictionary showing user-defined terms, technical jargon, and pronunciation mappings"
            width={800}
            height={500}
            loading="lazy"
            class="w-full h-auto"
          />
        </button>
        <p class="text-center font-body text-text-tertiary text-sm mt-4">
          Teach QuickSay your domain-specific terms, names, and acronyms. Never spell out "API" again.
        </p>
      </div>

      <!-- Onboarding Panel -->
      <div role="tabpanel" id="panel-onboarding" aria-labelledby="tab-onboarding" class="screenshot-panel transition-opacity duration-300 opacity-0 hidden">
        <button
          class="bg-surface border border-border rounded-xl overflow-hidden card-hover cursor-zoom-in w-full text-left"
          data-lightbox-trigger
          data-lightbox-src="/images/screenshots/onboarding-full.png?v=4"
          data-lightbox-alt="Full-size view of QuickSay setup wizard showing simple 3-step onboarding with account connection and microphone selection"
          aria-label="View full-size screenshot of QuickSay setup wizard"
        >
          <OptimizedImage
            src="onboarding"
            type="screenshot"
            variant="full"
            alt="QuickSay setup wizard showing simple 3-step onboarding with account connection and microphone selection"
            width={800}
            height={500}
            loading="lazy"
            class="w-full h-auto"
          />
        </button>
        <p class="text-center font-body text-text-tertiary text-sm mt-4">
          Three steps. Three minutes. Connect your free AI account, select your mic, and you're ready.
        </p>
      </div>
    </div>
  </div>
</section>

<!-- Lightbox Dialog (native <dialog> with data-attribute triggers) -->
<dialog id="screenshot-lightbox" class="lightbox-dialog">
  <div class="lightbox-content">
    <button class="lightbox-close" aria-label="Close lightbox">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
        <path d="M18 6L6 18M6 6l12 12"/>
      </svg>
    </button>
    <img id="screenshot-lightbox-image" alt="" width="800" height="700" class="lightbox-image" />
  </div>
</dialog>

<style>
  /* Lightbox Dialog Styling */
  .lightbox-dialog {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    padding: 0;
    margin: 0;
    border: none;
    background: transparent;
    max-width: 100%;
    max-height: 100vh;
    z-index: 9999;
  }

  .lightbox-dialog::backdrop {
    background: rgba(0, 0, 0, 0.9);
    backdrop-filter: blur(8px);
  }

  .lightbox-content {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100vh;
    padding: 2rem;
  }

  .lightbox-image {
    max-width: min(90vw, 800px);
    max-height: 90vh;
    width: auto;
    height: auto;
    object-fit: contain;
    border-radius: 12px;
    box-shadow: 0 8px 48px rgba(0, 0, 0, 0.6);
  }

  .lightbox-close {
    position: absolute;
    top: 1.5rem;
    right: 1.5rem;
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(28, 28, 32, 0.9);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 150ms ease;
    backdrop-filter: blur(8px);
    z-index: 10;
  }

  .lightbox-close:hover {
    background: rgba(28, 28, 32, 1);
    color: var(--text-primary);
    border-color: rgba(255, 255, 255, 0.2);
    transform: scale(1.05);
  }

  .lightbox-close:active {
    transform: scale(0.95);
  }

  /* Cursor zoom hint */
  .cursor-zoom-in {
    cursor: zoom-in;
  }

  /* Tab hover effects */
  .screenshot-tab:hover {
    background: rgba(255, 255, 255, 0.05);
  }

  .screenshot-tab:active {
    transform: scale(0.98);
  }
</style>

<script>
  /* Tab switching — ~200 bytes, same pattern as PersonaTabs */
  document.querySelectorAll('.screenshot-tab').forEach(tab => {
    tab.addEventListener('click', () => {
      // Deselect all tabs
      document.querySelectorAll('.screenshot-tab').forEach(t => {
        t.classList.remove('text-accent-teal', 'border-accent-teal');
        t.classList.add('text-text-secondary', 'border-transparent');
        t.setAttribute('aria-selected', 'false');
      });

      // Select clicked tab
      tab.classList.add('text-accent-teal', 'border-accent-teal');
      tab.classList.remove('text-text-secondary', 'border-transparent');
      tab.setAttribute('aria-selected', 'true');

      // Hide all panels with cross-fade
      document.querySelectorAll('.screenshot-panel').forEach(p => {
        p.classList.add('opacity-0', 'hidden');
      });

      // Show selected panel with cross-fade
      const panel = document.getElementById(tab.getAttribute('aria-controls'));
      panel.classList.remove('hidden');
      requestAnimationFrame(() => panel.classList.remove('opacity-0'));
    });
  });

  /* Lightbox using data-attribute triggers — ~200 bytes */
  const screenshotDialog = document.getElementById('screenshot-lightbox');
  const screenshotImg = document.getElementById('screenshot-lightbox-image');
  const screenshotClose = screenshotDialog?.querySelector('.lightbox-close');

  // Open lightbox on trigger click
  document.querySelectorAll('[data-lightbox-trigger]').forEach(trigger => {
    trigger.addEventListener('click', () => {
      const src = trigger.dataset.lightboxSrc;
      const alt = trigger.dataset.lightboxAlt || '';

      if (screenshotImg && screenshotDialog) {
        screenshotImg.src = src;
        screenshotImg.alt = alt;
        screenshotDialog.showModal();
        document.body.style.overflow = 'hidden';
      }
    });
  });

  // Close on button click
  screenshotClose?.addEventListener('click', () => {
    screenshotDialog?.close();
    document.body.style.overflow = '';
  });

  // Close on backdrop click
  screenshotDialog?.addEventListener('click', (e) => {
    if (e.target === screenshotDialog) {
      screenshotDialog.close();
      document.body.style.overflow = '';
    }
  });

  // Close on Escape key (handled by dialog natively)
  screenshotDialog?.addEventListener('close', () => {
    document.body.style.overflow = '';
  });
</script>
