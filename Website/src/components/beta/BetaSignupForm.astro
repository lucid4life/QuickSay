---
/**
 * BetaSignupForm — email capture form for the QuickSay beta program.
 * Client-side validation, honeypot spam protection, fetch-based submission.
 * Replaces form with success state on successful signup.
 */
---

<section id="signup" class="py-20 md:py-28 px-6">
  <div class="max-w-lg mx-auto">
    <!-- Form Card -->
    <div id="beta-form-card" class="fade-in-up bg-surface border border-border rounded-xl p-8 md:p-10">
      <h2 class="font-headline font-bold text-2xl md:text-3xl text-text-primary text-center mb-2">
        Get Beta Access
      </h2>
      <p class="font-body text-text-secondary text-center mb-8">
        Fill out the form and we'll send you the download link.
      </p>

      <form id="beta-signup-form" novalidate>
        <!-- Name -->
        <div class="mb-5">
          <label for="beta-name" class="block font-body text-sm font-medium text-text-secondary mb-2">
            Name <span class="text-accent-orange">*</span>
          </label>
          <input
            type="text"
            id="beta-name"
            name="name"
            required
            autocomplete="name"
            placeholder="Your first name"
            class="w-full bg-background border border-border rounded-lg px-4 py-3 text-text-primary font-body placeholder:text-text-tertiary focus:border-accent-teal focus:outline-none focus:ring-1 focus:ring-accent-teal transition-colors"
          />
        </div>

        <!-- Email -->
        <div class="mb-5">
          <label for="beta-email" class="block font-body text-sm font-medium text-text-secondary mb-2">
            Email <span class="text-accent-orange">*</span>
          </label>
          <input
            type="email"
            id="beta-email"
            name="email"
            required
            autocomplete="email"
            placeholder="you@example.com"
            class="w-full bg-background border border-border rounded-lg px-4 py-3 text-text-primary font-body placeholder:text-text-tertiary focus:border-accent-teal focus:outline-none focus:ring-1 focus:ring-accent-teal transition-colors"
          />
        </div>

        <!-- Primary Use Case -->
        <div class="mb-5">
          <label for="beta-usecase" class="block font-body text-sm font-medium text-text-secondary mb-2">
            Primary use case <span class="text-accent-orange">*</span>
          </label>
          <select
            id="beta-usecase"
            name="useCase"
            required
            class="w-full bg-background border border-border rounded-lg px-4 py-3 text-text-primary font-body focus:border-accent-teal focus:outline-none focus:ring-1 focus:ring-accent-teal transition-colors appearance-none"
            style="background-image: url('data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2212%22 height=%2212%22 viewBox=%220 0 24 24%22 fill=%22none%22 stroke=%22%238a8a95%22 stroke-width=%222%22%3E%3Cpath d=%22M6 9l6 6 6-6%22/%3E%3C/svg%3E'); background-repeat: no-repeat; background-position: right 1rem center;"
          >
            <option value="" disabled selected class="text-text-tertiary">Select your primary use</option>
            <option value="general">General productivity</option>
            <option value="coding">Coding / development</option>
            <option value="writing">Writing / content creation</option>
            <option value="accessibility">Accessibility</option>
            <option value="other">Other</option>
          </select>
        </div>

        <!-- Windows Version -->
        <div class="mb-6">
          <label for="beta-windows" class="block font-body text-sm font-medium text-text-secondary mb-2">
            Windows version <span class="text-accent-orange">*</span>
          </label>
          <select
            id="beta-windows"
            name="windowsVersion"
            required
            class="w-full bg-background border border-border rounded-lg px-4 py-3 text-text-primary font-body focus:border-accent-teal focus:outline-none focus:ring-1 focus:ring-accent-teal transition-colors appearance-none"
            style="background-image: url('data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2212%22 height=%2212%22 viewBox=%220 0 24 24%22 fill=%22none%22 stroke=%22%238a8a95%22 stroke-width=%222%22%3E%3Cpath d=%22M6 9l6 6 6-6%22/%3E%3C/svg%3E'); background-repeat: no-repeat; background-position: right 1rem center;"
          >
            <option value="" disabled selected class="text-text-tertiary">Select your Windows version</option>
            <option value="windows-11">Windows 11</option>
            <option value="windows-10">Windows 10</option>
            <option value="not-sure">Not sure</option>
          </select>
        </div>

        <!-- Honeypot -->
        <input type="text" name="website" class="hidden" tabindex="-1" autocomplete="off" />

        <!-- Error message -->
        <div id="beta-error" class="hidden mb-4 p-3 rounded-lg bg-red-900/20 border border-red-500/30 text-red-400 text-sm font-body text-center" role="alert">
        </div>

        <!-- Submit -->
        <button
          type="submit"
          id="beta-submit"
          class="w-full bg-accent-teal text-background font-headline font-semibold text-lg rounded-lg py-3.5 hover:scale-[1.02] hover:shadow-lg hover:shadow-teal-glow active:scale-[0.98] transition-all duration-150 cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100"
        >
          Get Beta Access
        </button>
      </form>

      <p class="text-text-secondary text-sm mt-4 text-center font-body">
        We'll email you the download link and getting started guide within 24 hours.
      </p>
    </div>

    <!-- Success State (hidden by default) -->
    <div id="beta-success" class="hidden bg-surface border border-border rounded-xl p-8 md:p-10 text-center">
      <!-- Teal check circle -->
      <div class="flex justify-center mb-6">
        <svg class="w-16 h-16 text-accent-teal" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
      </div>

      <h2 class="font-headline font-bold text-3xl text-accent-teal mb-3">
        You're in!
      </h2>
      <p class="font-body text-text-secondary text-lg mb-8">
        Check your inbox — we'll send everything you need within 24 hours.
      </p>

      <!-- Quick steps -->
      <div class="text-left space-y-4 mb-8">
        <div class="flex items-start gap-4">
          <span class="shrink-0 w-8 h-8 rounded-full bg-accent-teal/10 text-accent-teal font-mono font-bold text-sm flex items-center justify-center">1</span>
          <div>
            <p class="font-headline font-semibold text-text-primary">Install QuickSay</p>
            <p class="font-body text-text-secondary text-sm">Download and run the installer (~105 MB)</p>
          </div>
        </div>
        <div class="flex items-start gap-4">
          <span class="shrink-0 w-8 h-8 rounded-full bg-accent-teal/10 text-accent-teal font-mono font-bold text-sm flex items-center justify-center">2</span>
          <div>
            <p class="font-headline font-semibold text-text-primary">Set up your API key</p>
            <p class="font-body text-text-secondary text-sm">Free Groq account, takes 2 minutes</p>
          </div>
        </div>
        <div class="flex items-start gap-4">
          <span class="shrink-0 w-8 h-8 rounded-full bg-accent-teal/10 text-accent-teal font-mono font-bold text-sm flex items-center justify-center">3</span>
          <div>
            <p class="font-headline font-semibold text-text-primary">Share your feedback</p>
            <p class="font-body text-text-secondary text-sm">Help us make QuickSay great before launch</p>
          </div>
        </div>
      </div>

      <div class="flex flex-col sm:flex-row gap-3">
        <a
          href="/downloads/QuickSay-Setup.exe"
          download
          class="flex-1 inline-flex items-center justify-center bg-accent-teal text-background font-headline font-semibold rounded-lg py-3 hover:scale-[1.02] hover:shadow-lg hover:shadow-teal-glow active:scale-[0.98] transition-all duration-150"
        >
          Download QuickSay
        </a>
        <a
          href="/beta/getting-started"
          class="flex-1 inline-flex items-center justify-center bg-background border border-border text-text-primary font-headline font-semibold rounded-lg py-3 hover:border-accent-teal/50 active:scale-[0.98] transition-all duration-150"
        >
          Getting Started Guide
        </a>
      </div>
    </div>
  </div>
</section>

<script>
  const form = document.getElementById('beta-signup-form');
  const formCard = document.getElementById('beta-form-card');
  const successCard = document.getElementById('beta-success');
  const errorEl = document.getElementById('beta-error');
  const submitBtn = document.getElementById('beta-submit');

  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

  function showError(message) {
    errorEl.textContent = message;
    errorEl.classList.remove('hidden');
  }

  function hideError() {
    errorEl.classList.add('hidden');
    errorEl.textContent = '';
  }

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    hideError();

    const name = document.getElementById('beta-name').value.trim();
    const email = document.getElementById('beta-email').value.trim();
    const useCase = document.getElementById('beta-usecase').value;
    const windowsVersion = document.getElementById('beta-windows').value;
    const honeypot = form.querySelector('input[name="website"]').value;

    // Client-side validation
    if (!name) {
      showError('Please enter your name.');
      document.getElementById('beta-name').focus();
      return;
    }

    if (!email) {
      showError('Please enter your email address.');
      document.getElementById('beta-email').focus();
      return;
    }

    if (!emailRegex.test(email)) {
      showError('Please enter a valid email address.');
      document.getElementById('beta-email').focus();
      return;
    }

    if (!useCase) {
      showError('Please select your primary use case.');
      document.getElementById('beta-usecase').focus();
      return;
    }

    if (!windowsVersion) {
      showError('Please select your Windows version.');
      document.getElementById('beta-windows').focus();
      return;
    }

    // Disable button during submission
    submitBtn.disabled = true;
    submitBtn.textContent = 'Submitting...';

    try {
      const response = await fetch('/api/beta-signup', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          name,
          email,
          useCase,
          windowsVersion,
          website: honeypot,
        }),
      });

      const data = await response.json();

      if (data.success) {
        // Show success state
        formCard.classList.add('hidden');
        successCard.classList.remove('hidden');
      } else {
        showError(data.error || 'Something went wrong. Please try again.');
        submitBtn.disabled = false;
        submitBtn.textContent = 'Get Beta Access';
      }
    } catch (err) {
      showError('Network error. Please check your connection and try again.');
      submitBtn.disabled = false;
      submitBtn.textContent = 'Get Beta Access';
    }
  });
</script>
