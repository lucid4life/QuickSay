---
import BaseLayout from '../layouts/BaseLayout.astro';
import Navbar from '../components/Navbar.astro';
import Footer from '../components/Footer.astro';
import { getCollection, render } from 'astro:content';

const entries = (await getCollection('changelog')).sort((a, b) => {
  // Sort by version descending (newest first)
  return b.data.version.localeCompare(a.data.version, undefined, { numeric: true });
});
---

<BaseLayout
  title="Changelog â€” QuickSay"
  description="QuickSay release history and version notes. See what's new, improved, fixed, and changed in every release of QuickSay for Windows."
  canonicalUrl="https://quicksay.app/changelog"
>
  <Navbar slot="header" />

  <section class="max-w-3xl mx-auto px-6 pt-32 pb-20">
    <h1 class="font-headline font-bold text-4xl text-text-primary mb-3">Changelog</h1>
    <p class="text-text-secondary text-lg mb-14">
      A history of every QuickSay release. All updates are free with your one-time purchase.
    </p>

    <div class="timeline">
      {entries.map(async (entry) => {
        const { Content } = await render(entry);
        const dateObj = new Date(entry.data.date + 'T00:00:00');
        const formattedDate = dateObj.toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'long',
          day: 'numeric',
        });
        return (
          <div class="timeline-entry">
            <div class="timeline-dot" />
            <div class="timeline-card">
              <div class="flex flex-wrap items-center gap-3 mb-3">
                <span class="version-badge">v{entry.data.version}</span>
                <time class="text-text-tertiary text-sm" datetime={entry.data.date}>
                  {formattedDate}
                </time>
              </div>
              <p class="text-text-secondary text-sm mb-4">{entry.data.summary}</p>
              <div class="changelog-content">
                <Content />
              </div>
            </div>
          </div>
        );
      })}
    </div>
  </section>

  <Footer slot="footer" />
</BaseLayout>

<style>
  /* Timeline */
  .timeline {
    position: relative;
    padding-left: 2rem;
  }

  .timeline::before {
    content: '';
    position: absolute;
    left: 0.4375rem;
    top: 0.5rem;
    bottom: 0.5rem;
    width: 2px;
    background-color: var(--accent-teal);
    opacity: 0.3;
  }

  .timeline-entry {
    position: relative;
    padding-bottom: 3rem;
  }

  .timeline-entry:last-child {
    padding-bottom: 0;
  }

  .timeline-dot {
    position: absolute;
    left: -2rem;
    top: 0.375rem;
    width: 0.875rem;
    height: 0.875rem;
    border-radius: 50%;
    background-color: var(--accent-teal);
    border: 3px solid var(--background);
    box-shadow: 0 0 0 2px rgba(34, 211, 197, 0.3);
  }

  .timeline-card {
    padding: 1.25rem 1.5rem;
    border: 1px solid var(--border);
    border-radius: 0.5rem;
    background-color: var(--surface);
  }

  .version-badge {
    display: inline-flex;
    align-items: center;
    padding: 0.125rem 0.625rem;
    border-radius: 9999px;
    background-color: rgba(255, 120, 60, 0.12);
    color: var(--accent-orange);
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.8125rem;
    font-weight: 600;
  }

  /* Changelog content styling */
  .changelog-content :global(ul) {
    list-style: none;
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: 0.375rem;
  }

  .changelog-content :global(li) {
    color: var(--text-secondary);
    font-size: 0.875rem;
    line-height: 1.6;
    padding-left: 0.25rem;
  }

  .changelog-content :global(strong) {
    color: var(--text-primary);
    font-weight: 600;
  }
</style>
